{% extends 'main/base.html' %}
{% load static %}
{% load main_filters %}
{% block content %}
{% if is_owner %}
    <div class="container-fluid" style="padding: 25px;">
        <!-- Center image -->
        <img class="img-fluid rounded" src="{{ player.headshot }}" style="height: 250px; width: 250px; display: block; margin-left: auto; margin-right: auto;" alt="Center">
        <h2 class="text-uppercase fw-bold mb-3 mt-3" style="text-align: center;">{{ player.first_name}} {{ player.last_name}}</h2>
        <p style="text-align: center;">
            <!-- Upgrade & upgrade logs -->
            <a class="btn btn-primary btn-sm text-white" href="{% url 'upgrade_player' player.id %}">Upgrade player</a>
            <a class="btn btn-primary btn-sm text-white" href="{% url 'upgrade_logs' player.id %}">Upgrade history</a>
            <a class="btn btn-primary btn-sm text-white" href="{% url 'cash_logs' player.id %}">Cash history</a>
            <!-- Player file -->
            <button id="file" type="button" class="copyJSON btn btn-primary btn-sm" onClick="clipboard(this.id)">Copy File</button>
            <p id="json_file" class="file" style="font-size: 6px; display: none;">{{ file }}</p>
            <!-- Upgrades pending? -->
            {% if player.upgrades_pending %}
                <p class="fw-bold text-danger text-center">Pending upgrades</p>
            {% else %}
                <p class="fw-bold text-success text-center">No pending upgrades</p>
            {% endif %}
        </p>
    </div>
    <hr>
    <div class="container-fluid" style="padding: 25px;">
        <!-- Add form to pay player if user.can_update_players -->
        {% if user.can_update_players %}
            <div class="container">
                <div class="row">
                    <!-- Pay players -->
                    <div class="col-6 mb-2">
                        <div class="card">
                            <div class="card-header">
                                <h3><span class="panel-title-text">Add Cash</span></h3>
                            </div>
                            <div class="card-body">
                                <form action="{% url 'add_player_cash' %}" method="POST">
                                    {% csrf_token %}
                                    <input type="hidden" name="id" value="{{ player.id }}">
                                    <div class="row">
                                        <div class="col-12 mb-2">
                                            <!-- Text area for adding cash -->
                                            <input name="amount" class="form-control mb-1" type="number" required placeholder="Enter cash amount"/>
                                            <input name="reason" class="form-control" type="text" required placeholder="Enter reason"/><hr>
                                            <input name="bypass" class="form-check-input" type="checkbox" value="true" id="bypass">
                                            <label for="bypass">Bypass Weekly Earnings</label><hr>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12"><button class="btn btn-success btn-sm d-block w-100" type="submit">Add cash</button></div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                    <!-- Fine players -->
                    <div class="col-6">
                        <div class="card">
                            <div class="card-header">
                                <h3><span class="panel-title-text">Take Cash</span></h3>
                            </div>
                            <div class="card-body">
                                <form action="{% url 'take_player_cash' %}" method="POST">
                                    {% csrf_token %}
                                    <input type="hidden" name="id" value="{{ player.id }}">
                                    <div class="row">
                                        <div class="col-12 mb-2">
                                            <!-- Text area for adding cash -->
                                            <input name="amount" class="form-control mb-1" type="number" required placeholder="Enter cash amount"/>
                                            <input name="reason" class="form-control" type="text" required placeholder="Enter reason"/>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12"><button class="btn btn-danger btn-sm d-block w-100" type="submit">Take cash</button></div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    </div>
                <div class="card-body">
                        <form>
                            {% csrf_token %}
                            <div class="row">
                                <p id="reward-result" class="mt-1 mb-2" style="font-size:14px;">Collect your daily rewards!</p>
                            </div>
                            <div class="row">
                                <div class="col-12"><button class="btn btn-success btn-lg d-block w-100" type="submit" hx-post="/player/daily/reward/" hx-trigger="click delay:200ms" hx-target="#reward-result" hx-swap="innerHTML" onkeydown="return event.key != 'Enter';">Collect</button></div>
                            </div>
                        </form>
                    </div>
                <!-- Redesign attempt -->
                <ul class="nav nav-tabs" id="myTabs">
                    <li class="nav-item">
                        <a class="nav-link active" id="tab1" data-bs-toggle="tab" href="#menu1">Attributes</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="tab2" data-bs-toggle="tab" href="#menu2">Badges</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="tab3" data-bs-toggle="tab" href="#menu3">Tendencies</a>
                    </li>
                </ul>

    <style>
.tab-pane {
    display: none;  /* Hide all tabs by default */
}

.tab-pane.show {
    display: block;  /* Only show the active tab */
}
</style>

                <div class="tab-content">
                    <!-- Attribute menu -->
                    <div class="tab-pane fade show active mt-2" id="menu1">
                        <div class="d-flex justify-content-start" style="gap: 20px;">
                            <div id="finishing-attributes">
                                <table>
                                    <thead>
                                        <tr class="border-bottom"><th class="p-0" colspan="2">Finishing</th></tr>
                                    </thead>
                                    <tbody>
                                        {% for k, v in player.attributes.items %}
                                            <tr>
                                                {% if k in finishing_attributes %}
                                                    <td>{{ k }}:</td>
                                                    <td style="padding-left: 10px;">{{ v }}</td>
                                                {% endif %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            <div id="shooting-attributes">
                                <table>
                                    <thead>
                                        <tr class="border-bottom"><th class="p-0" colspan="2">Shooting</th></tr>
                                    </thead>
                                    <tbody>
                                        {% for k, v in player.attributes.items %}
                                            <tr>
                                                {% if k in shooting_attributes %}
                                                    <td>{{ k }}:</td>
                                                    <td style="padding-left: 10px;">{{ v }}</td>
                                                {% endif %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            <div id="playmaking-attributes">
                                <table>
                                    <thead>
                                        <tr class="border-bottom"><th class="p-0" colspan="2">Playmaking</th></tr>
                                    </thead>
                                    <tbody>
                                        {% for k, v in player.attributes.items %}
                                            <tr>
                                                {% if k in playmaking_attributes %}
                                                    <td>{{ k }}:</td>
                                                    <td style="padding-left: 10px;">{{ v }}</td>
                                                {% endif %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            <div id="defense-attributes">
                                <table>
                                    <thead>
                                        <tr class="border-bottom"><th class="p-0" colspan="2">Defense</th></tr>
                                    </thead>
                                    <tbody>
                                        {% for k, v in player.attributes.items %}
                                            <tr>
                                                {% if k in defense_attributes %}
                                                    <td>{{ k }}:</td>
                                                    <td style="padding-left: 10px;">{{ v }}</td>
                                                {% endif %}
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div> 
                        </div>
                    </div>
                    <!-- Badge menu -->
                    <div class="tab-pane fade" id="menu2">
                            <div class="container">
                                <div class="row">
                                    {% for k, v in player.badges.items %} 
                                        {% if k in finishing_badges %}
                                            <div class="col-md-2 mb-2">
                                                <p class="mt-0 mb-1"><b>{{ k }}</b></p>
                                                {% if v == 0 %}
                                                    {{ badgeEmojis.0 }} Unequipped
                                                {% elif v == 1 %}
                                                    {{ badgeEmojis.1 }} Bronze
                                                {% elif v == 2 %}
                                                    {{ badgeEmojis.2 }} Silver
                                                {% elif v == 3 %}
                                                    {{ badgeEmojis.3 }} Gold
                                                {% elif v == 4 %}
                                                    {{ badgeEmojis.4 }} Hall of Fame
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                                <hr>
                            </div>
                
                
                            <div class="container">
                                <div class="row">
                                    {% for k, v in player.badges.items %} 
                                        {% if k in shooting_badges %}
                                            <div class="col-md-2 mb-2">
                                                <p class="mt-0 mb-1"><b>{{ k }}</b></p>
                                                {% if v == 0 %}
                                                    {{ badgeEmojis.0 }} Unequipped
                                                {% elif v == 1 %}
                                                    {{ badgeEmojis.1 }} Bronze
                                                {% elif v == 2 %}
                                                    {{ badgeEmojis.2 }} Silver
                                                {% elif v == 3 %}
                                                    {{ badgeEmojis.3 }} Gold
                                                {% elif v == 4 %}
                                                    {{ badgeEmojis.4 }} Hall of Fame
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                
                            <hr>
                
                            <div class="container">
                                <div class="row">
                                    {% for k, v in player.badges.items %} 
                                        {% if k in playmaking_badges %}
                                            <div class="col-md-2 mb-2">
                                                <p class="mt-0 mb-1"><b>{{ k }}</b></p>
                                                {% if v == 0 %}
                                                    {{ badgeEmojis.0 }} Unequipped
                                                {% elif v == 1 %}
                                                    {{ badgeEmojis.1 }} Bronze
                                                {% elif v == 2 %}
                                                    {{ badgeEmojis.2 }} Silver
                                                {% elif v == 3 %}
                                                    {{ badgeEmojis.3 }} Gold
                                                {% elif v == 4 %}
                                                    {{ badgeEmojis.4 }} Hall of Fame
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                
                            <hr>
                
                            <div class="container">
                                <div class="row">
                                    {% for k, v in player.badges.items %} 
                                        {% if k in defense_badges %}
                                            <div class="col-md-2 mb-2">
                                                <p class="mt-0 mb-1"><b>{{ k }}</b></p>
                                                {% if v == 0 %}
                                                    {{ badgeEmojis.0 }} Unequipped
                                                {% elif v == 1 %}
                                                    {{ badgeEmojis.1 }} Bronze
                                                {% elif v == 2 %}
                                                    {{ badgeEmojis.2 }} Silver
                                                {% elif v == 3 %}
                                                    {{ badgeEmojis.3 }} Gold
                                                {% elif v == 4 %}
                                                    {{ badgeEmojis.4 }} Hall of Fame
                                                {% endif %}
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>
                            </div>
                
                            <hr>
                
                        </div>
                    </div>
                </div>
            </div>
                    </div>
                    <!-- Tendency menu -->
                    <div class="tab-pane fade" id="menu3">
            <!-- Tendency accordion -->
                    <div class="accordion-body">
                        <div class="container-fluid mt-5" style="padding: 100px; padding-top: 0px; padding-bottom: 10px;">
                            <div class="container">
                                <div class="row">
                                    {% for k, v in player.tendencies.items %} 
                                        <div class="col-md-4 mb-2">
                                            <p class="mt-0 mb-1"><b>{{ k }}</b></p>
                                            <p>{{ v }}</p>
                                        </div>
                                    {% endfor %}
                                </div>
                                <hr>
                            </div>
                        </div>
                    </div>                  
                </div>
            </div>
</div>
</div>
</div>
        <div class="tab-pane fade show active mt-2" id="menu4">
<div class="tab-content">
    <!-- Player details -->
    <div class="tab-pane fade show active mt-2" id="playerDetails">
        <div class="container">
            <div class="row">
                <!-- Uneditable player details -->
                <div class="col-md-2">
                    <p><b>Full Name</b></p><hr>
                    <p>{{ player.first_name }} {{ player.last_name }}</p>
                </div>
                <div class="col-md-2">
                    <p><b>Height</b></p><hr>
                    <p>{{ height_in_feet }}</p>
                </div>
                <div class="col-md-2">
                    <p><b>Weight</b></p><hr>
                    <p>{{ player.weight }} <a href="{% url 'edit_physicals' player.id %}">Edit</a></p>
                </div>
                <div class="col-md-2">
                    <p><b>Position</b></p><hr>
                    <p>{{ player.primary_position }}/{{ player.secondary_position }}</p>
                </div>
                <div class="col-md-2">
                    <p><b>Team</b></p><hr>
                    <p>{{ player.current_team.abbrev }}</p>
                </div>
                <div class="col-md-2">
                    <p><b>Spent</b></p><hr>
                    <p>${{ player.spent }}</p>
                </div>
                <!-- Editable player details -->
                <div class="row mb-3">
                    <!-- Editable by player owner -->
                    {% if player.discord_user == user %}
                        <form action="{% url 'update_player_vitals' player.id %}" method="POST">
                            {% csrf_token %}
                            <!-- Put jersey and cyberface horizontall -->
                            <div class="row">
                                <div class="col-md-2">
                                    <p><b>Jersey</b></p><hr>
                                    <input name="jersey" class="form-control mb-2" type="number" style="width: 50%;" value="{{ player.jersey_number }}"/>
                                </div>
                                <div class="col-md-2">
                                    <p><b>Cyberface</b></p><hr>
                                    <input name="cyberface" class="form-control mb-2" type="number" style="width: 50%;" value="{{ player.cyberface }}"/>
                                </div>
                                <div class="col-md-2">
                                    <p><b>Use Game Tendencies</b></p><hr>
                                    <select class="form-select mb-2" name="use_game" style="width: 50%">
                                        <option value="{{ player.use_game_tendencies }}">{{ player.use_game_tendencies }}</option>
                                        {% if player.use_game_tendencies %}
                                            <option value="False">False</option>
                                        {% else %}
                                            <option value="True">True</option>
                                        {% endif %}
                                    </select>
                                </div>
                                <br>
                                <!-- Play styles -->
                                <div class="col-md-2">
                                    <p><b>Play Style #1</b></p><hr>
                                    <select class="form-select mb-2" name="playstyle1" style="width: 50%">
                                        <option value="{{ playstyle1.1 }}">{{ playstyle1.0 }}</option>
                                        {% for i, playstyle in playstyles.items %}
                                            {% if not playstyle == playstyle1.0 %}
                                                <option value="{{ i }}">{{ playstyle }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <p><b>Play Style #2</b></p><hr>
                                    <select class="form-select mb-2" name="playstyle2" style="width: 50%">
                                        <option value="{{ playstyle2.1 }}">{{ playstyle2.0 }}</option>
                                        {% for i, playstyle in playstyles.items %}
                                            {% if not playstyle == playstyle2.0 %}
                                                <option value="{{ i }}">{{ playstyle }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <p><b>Play Style #3</b></p><hr>
                                    <select class="form-select mb-2" name="playstyle3" style="width: 50%">
                                        <option value="{{ playstyle3.1 }}">{{ playstyle3.0 }}</option>
                                        {% for i, playstyle in playstyles.items %}
                                            {% if not playstyle == playstyle3.0 %}
                                                <option value="{{ i }}">{{ playstyle }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <p><b>Play Style #4</b></p><hr>
                                    <select class="form-select mb-2" name="playstyle4" style="width: 50%">
                                        <option value="{{ playstyle4.1 }}">{{ playstyle4.0 }}</option>
                                        {% for i, playstyle in playstyles.items %}
                                            {% if not playstyle == playstyle4.0 %}
                                                <option value="{{ i }}">{{ playstyle }}</option>
                                            {% endif %}
                                        {% endfor %}
                                    </select>
                                </div>
                                <!-- Headshot -->
                                <div class="col-md-2">
                                    <p><b>Headshot</b></p><hr>
                                    <input name="headshot" class="form-control mb-2" type="text" style="width: 50%;" value="{{ player.headshot }}" placeholder="{{ player.headshot }}"/>
                                </div>
                                <!-- End of updateables -->
                            </div>
                            <button class="btn btn-success btn-sm mt-2" type="submit" onkeydown="return event.key != 'Enter';">Update</button>
                        </form>
                    {% else %}
                        <div class="col-md-2">
                            <p><b>Jersey</b></p><hr>
                            <p>#{{ player.jersey_number }}</p>
                        </div>
                        <div class="col-md-2">
                            <p><b>Cyberface</b></p><hr>
                            <p>{{ player.cyberface }}</p>
                        </div>
                        <div class="col-md-2">
                            <p><b>Use Game Tendencies</b></p><hr>
                            <p>{{ player.use_game_tendencies }}</p>
                        </div>
                        <div class="col-md-2">
                            <p><b>Play Style #1</b></p><hr>
                            <p>{{ playstyle1.0 }}</p>
                        </div>
                        <div class="col-md-2">
                            <p><b>Play Style #2</b></p><hr>
                            <p>{{ playstyle2.0 }}</p>
                        </div>
                        <div class="col-md-2">
                            <p><b>Play Style #3</b></p><hr>
                            <p>{{ playstyle3.0 }}</p>
                        </div>
                        <div class="col-md-2">
                            <p><b>Play Style #4</b></p><hr>
                            <p>{{ playstyle4.0 }}</p>
                        </div>
                    {% endif %}
                                    <p class="mb-0"><b>Creator:</b> {{ player.discord_user.discord_tag }}</p>
                <p><b>Week Earnings:</b> ${{ week_earnings }}</p>
                <!-- Contract details -->
                <hr>
                <p class="mb-0"><b>Referral Code:</b> {{ player.id }}</p>
                <p class="mb-0"><b>Contract Salary:</b> ${{ player.salary }}</p>
                <p class="mb-0"><b>Contract Expires:</b> <i></i> Season {{ player.contract_ends_after }}</p>
                <p class="mb-0"><b>Contract Option:</b> {{ player.contract_option }}</p>
                <p class="mb-0"><b>Contract Benefits:</b> {{ player.contract_benefits }}</p>            </div>
        </div>
    </div>
                <!-- Award details -->
                <hr class="mt-3">
                <p class="mb-0">
                    {% if awards.MVP %}
                        🏆 <b>MVP:</b>
                        {% for a in awards.MVP %}
                            S{{ a }} 
                        {% endfor %}<br>
                    {% endif %}
                    {% if awards.DPOY %}
                        🔏 <b>DPOY:</b>
                        {% for a in awards.DPOY %}
                            S{{ a }} 
                        {% endfor %}<br>
                    {% endif %}
                    {% if awards.MIP %}
                        💹 <b>MIP:</b>
                        {% for a in awards.MIP %}
                            S{{ a }} 
                        {% endfor %}<br>
                    {% endif %}
                    {% if awards.ROY %}
                        👦 <b>ROY:</b>
                        {% for a in awards.ROY %}
                            S{{ a }} 
                        {% endfor %}<br>
                    {% endif %}
                    {% if awards.AH1ST %}
                        🏀 <b>AH1ST:</b>
                        {% for a in awards.AH1ST %}
                            S{{ a }} 
                        {% endfor %}<br>
                    {% endif %}
                    {% if awards.AH2ND %}
                        🏀 <b>AH2ND:</b>
                        {% for a in awards.AH2ND %}
                            S{{ a }} 
                        {% endfor %}<br>
                    {% endif %}
                    {% if awards.D1ST %}
                        🔒 <b>D1ST:</b>
                        {% for a in awards.D1ST %}
                            S{{ a }} 
                        {% endfor %}<br>
                    {% endif %}
                    {% if awards.D2ND %}
                        🔒 <b>D2ND:</b>
                        {% for a in awards.D2ND %}
                            S{{ a }} 
                        {% endfor %}<br>
                    {% endif %}
                    {% if awards.KOTS %}
                        👑 <b>KOTS:</b> x{{ awards.KOTS }}<br>
                    {% endif %}
                    {% if awards.RING %}
                        💍 <b>RING:</b>
                        {% for a in awards.RING %}
                            S{{ a }} 
                        {% endfor %}<br>
                    {% endif %}
                    {% if awards.FMVP %}
                        🌟 <b>FMVP:</b>
                        {% for a in awards.FMVP %}
                            S{{ a }} 
                        {% endfor %}<br>
                    {% endif %}
                    {% if awards.ASG %}
                        ⭐ <b>ASG:</b>
                        {% for a in awards.ASG %}
                            S{{ a }} 
                        {% endfor %}<br>
                    {% endif %}
                    {% if awards.ASGMVP %}
                        💫 <b>ASGMVP:</b>
                        {% for a in awards.ASGMVP %}
                            S{{ a }} 
                        {% endfor %}<br>
                    {% endif %}
                    {% if awards.3PTWIN %}
                        3️⃣ <b>3PTWIN:</b>
                        {% for a in awards.3PTWIN %}
                            S{{ a }} 
                        {% endfor %}<br> 
                    {% endif %}
                    {% if awards.DNKWIN %}
                        💪 <b>DNKWIN:</b>
                        {% for a in awards.DNKWIN %}
                            S{{ a }} 
                        {% endfor %}<br> 
                    {% endif %}
                </p>
                </div>                  
                </div>
</div>
            </div>

{% else %}
<div class="container mt-5">
    <!-- Player's Main Details -->
    <div class="row align-items-center">
        <div class="col-md-2">
            <img src="{{ player.headshot }}" alt="Player Headshot" class="img-fluid rounded-circle" style="max-width: 100px;">
        </div>
        <div class="col-md-8 text-center">
            <h2>{{ player.first_name }} {{ player.last_name }}</h2>
            <h4>#{{ player.jersey_number }} | {{ player.primary_position }}/{{ player.secondary_position }} | {{ player.current_team.abbrev }}</h4>
            <h5>{{ player.discord_user.discord_tag }} | Earnings: ${{ week_earnings }} | Spent: ${{ player.spent }}</h5>
        </div>
        <div class="col-md-2 text-end">
            <h4>${{ player.salary }}</h4>
            <p>Contract Ends: Season {{ player.contract_ends_after }}</p>
        </div>
    </div>
    <hr>

    <!-- Player's Physical & Play Style Details -->
    <div class="row mt-4">
        <div class="col-md-3">
            <p><b>Height:</b> {{ height_in_feet }}</p>
            <p><b>Weight:</b> {{ player.weight }}</p>
            <p><b>Cyberface:</b> {{ player.cyberface }}</p>
        </div>
        <div class="col-md-3">
            <p><b>Play Style #1:</b> {{ playstyle1.0 }}</p>
            <p><b>Play Style #2:</b> {{ playstyle2.0 }}</p>
        </div>
        <div class="col-md-3">
            <p><b>Play Style #3:</b> {{ playstyle3.0 }}</p>
            <p><b>Play Style #4:</b> {{ playstyle4.0 }}</p>
        </div>
        <div class="col-md-3">
            <p><b>Use Game Tendencies:</b> {{ player.use_game_tendencies }}</p>
        </div>
    </div>

    <!-- Contract Details -->
    <div class="row mt-3">
        <div class="col-md-4">
            <p><b>Referral Code:</b> {{ player.id }}</p>
        </div>
        <div class="col-md-4">
            <p><b>Contract Option:</b> {{ player.contract_option }}</p>
        </div>
        <div class="col-md-4">
            <p><b>Contract Benefits:</b> {{ player.contract_benefits }}</p>
        </div>
    </div>

    <!-- Player's Awards -->
    <div class="row mt-5">
        <div class="col-md-12">
            <h3>Awards</h3>
            <!-- Reuse the existing awards code -->
            <p class="mb-0">
                {% if awards.MVP %}
                    🏆 <b>MVP:</b>
                    <!-- ... and so on for each award ... -->
                </p>
            </div>
        </div>
    </div>
</div>
</div>

{% endif %}
{% endif %}
<script src="{% static 'main/js/players/copyJSON.js' %}"></script>
{% endblock %}
